<html>
	<head>
		<meta charset = "UTF-8">
	</head>
	
	<body style = "margin: 0;">
		<div style = "background-color: gray; position: relative; left: 0; top: 0; width: 700px; height: 100%; margin-left: auto; margin-right: auto;">
			<!--<input type="file" id="file" onchange="test()"/>-->
			<div style = "position: absolute; left: 140px; top: 100px">
				<input id = "buttonPlan1" type = "button" value = "План #1" onclick = "setPlan(1)" style = "padding: 10px; float: left; width: 200px;">
				<input id = "buttonPlan2" type = "button" value = "План #2" onclick = "setPlan(2)" style = "padding: 10px; float: left; width: 200px">
			</div>
			
			<div style = "position: absolute; left: 200; top: 160px; color: white; user-select: none" title = "Минути преди началния час за първия звъцен">
				Минути (?): 
				<input type = "number" style = "width: 70px;" min = "0" max = "59" value = "3"/>
			</div>
		
			<table id = "hoursTablePlan1" style = "position: absolute; left: 30px; top: 200px; width: 640px; color: white; border: 1px solid black;">
				<tr>
					<th style = "display: none">#</th>
					<th style = "border: 1px solid black; width: 20px;">#</th>
					<th style = "border: 1px solid black;">НАЧАЛО</th>
					<th style = "border: 1px solid black">КРАЙ</th>
					<th style = "border: 1px solid black">ФУНКЦИИ</th>
				</tr>
				
				<tr>
					<td colspan = "5" style = "margin: auto;">
						<input type = "button" value = "Добави ред" onclick = "addRow('hoursTablePlan1')" style = "width: 100%;"/>
					</td>
				</tr>
			</table>
			
			<table id = "hoursTablePlan2" style = "position: absolute; left: 30px; top: 200px; width: 640px; color: white; border: 1px solid black;">
				<tr>
					<th style = "display: none">#</th>
					<th style = "border: 1px solid black; width: 20px;">#</th>
					<th style = "border: 1px solid black;">НАЧАЛО</th>
					<th style = "border: 1px solid black">КРАЙ</th>
					<th style = "border: 1px solid black">ФУНКЦИИ</th>
				</tr>
				
				<tr>
					<td colspan = "5" style = "margin: auto;">
						<input type = "button" value = "Добави ред" onclick = "addRow('hoursTablePlan2')" style = "width: 100%;"/>
					</td>
				</tr>
			</table>
			
			<!--<input type="time" min="09:00" max="18:00">-->
		</div>
		
		<div style = "position: absolute; left: 10; bottom: 20;">
			Created by 
			<a href = "https://github.com/taulfsime">taulfsime</a>
		</div>
	</body>
	
	<script>
		var rowsIdCounts = [0, 0];
	
		/*function test() {
			var test = document.getElementById("file");
		
			if(test.files.length == 0) {
				return;
			}
			
			var fileReader = new FileReader();
			fileReader.onload = (e) => {
				console.log(e);
			}
			
			fileReader.readAsText(test.files[0]);
		}*/
	
		function updateNumbers(tableId) {
			var table = document.getElementById(tableId);
			if(table.rows.legend <= 2) {
				return;
			}
			
			for(var i = 1; i < table.rows.length - 1; i++) {
				table.rows[i].cells[1].innerHTML = i;
			}
		}
		
		function deleteRow(tableId, id) {
			var table = document.getElementById(tableId);
						
			if(table.rows.length <= 2) {
				return;
			}
			
			for(var i = 1; i < table.rows.length - 1; i++) {
				if(table.rows[i].cells[0].innerHTML == id) {
					table.deleteRow(i);
					break;
				}
			}
			
			updateNumbers(tableId);
		}
		
		function addMinutes(timeString, mins) {
				var hours = parseInt(timeString.split(":")[0]);
				var minutes = parseInt(timeString.split(":")[1]);
				
				minutes += mins;
				if(minutes < 0) {
					hours -= 1;
					minutes += 60;
				}
				else if(minutes >= 60) {
					hours += 1;
					minutes -= 60;
				}
				
				if(hours < 0) {
					hours += 23;
				}
				else if(hours >= 24) {
					hours -= 23;
				}
				
				timeString = (hours < 10 ? "0" : "") + hours.toString() + ":" + (minutes < 10 ? "0" : "") + minutes.toString();
				return timeString;
			}
	
		function addRow(tableId) {
			var table = document.getElementById(tableId);
			var rowCount = table.rows.length;
			var row = table.insertRow(rowCount - 1);
			
			var cellId = row.insertCell(0);
			cellId.style = "display: none";
			cellId.innerHTML = rowsIdCounts[tableId == "hoursTablePlan1" ? 0 : 1];
			rowsIdCounts[tableId == "hoursTablePlan1" ? 0 : 1] += 1;
			
			var cellCount = row.insertCell(1);
			cellCount.innerHTML = rowCount - 1;
			
			//Cell for setting start hour
			var cellHourStart = row.insertCell(2);
			
			//setting start hour checkbox
			var elementCheckHourStart = document.createElement("input");
			elementCheckHourStart.type = "checkbox";
			elementCheckHourStart.checked = true;
			cellHourStart.appendChild(elementCheckHourStart);
			
			//sestting start hour time
			var elementHourStart = document.createElement("input");
			elementHourStart.type = "time";
			cellHourStart.appendChild(elementHourStart);
			
			//Cell for setting end hour
			var cellHourEnd = row.insertCell(3);
			
			//setting end hour checkbox
			var elementCheckHourEnd = document.createElement("input");
			elementCheckHourEnd.type = "checkbox";
			elementCheckHourEnd.checked = false;
			cellHourEnd.appendChild(elementCheckHourEnd);
			
			//sestting end hour time
			var elementHourEnd = document.createElement("input");
			elementHourEnd.type = "time";
			cellHourEnd.appendChild(elementHourEnd);
			
			elementCheckHourStart.onchange = (e) => elementCheckHourEnd.checked = !e.target.checked;
			elementCheckHourEnd.onchange = (e) =>  elementCheckHourStart.checked = !e.target.checked;
			
			var funcs = row.insertCell(4);
			funcs.style = "position: relative; display: flex; flex-direction: row; justify-content: space-around;";
			
			var buttonTexts = [ "=", "-10", "-5", "+5", "+10", "X" ];
			var buttonTitles = [ "Копира времето от избрания елемент на другия елемент", "Изважда 10 минути от избраното време", "Изважда 5 минути от избраното време", "Добавя 5 минути към избраното време", "Добавя 10 минути към избраното време", "Изтрива реда" ];
			var buttonFuncs = [ 
								function() {
									if(elementCheckHourStart.checked) {
										if(elementHourStart.value.length > 0) {
											elementHourEnd.value = elementHourStart.value;
										}
									}
									else {
										if(elementHourEnd.value.length > 0) {
											elementHourStart.value = elementHourEnd.value;
										}
									}
								},
								function() {
									var timeString = (elementCheckHourStart.checked ? elementHourStart.value : elementHourEnd.value);
									timeString = addMinutes(timeString, -10);
									if(elementCheckHourStart.checked) {
										elementHourStart.value = timeString;
									}
									else {
										elementHourEnd.value = timeString;
									}
								},
								function() {
									var timeString = (elementCheckHourStart.checked ? elementHourStart.value : elementHourEnd.value);
									timeString = addMinutes(timeString, -5);
									if(elementCheckHourStart.checked) {
										elementHourStart.value = timeString;
									}
									else {
										elementHourEnd.value = timeString;
									}
								},
								function() {
									var timeString = (elementCheckHourStart.checked ? elementHourStart.value : elementHourEnd.value);
									timeString = addMinutes(timeString, 5);
									if(elementCheckHourStart.checked) {
										elementHourStart.value = timeString;
									}
									else {
										elementHourEnd.value = timeString;
									}
								},
								function() {
									var timeString = (elementCheckHourStart.checked ? elementHourStart.value : elementHourEnd.value);
									timeString = addMinutes(timeString, 10);
									if(elementCheckHourStart.checked) {
										elementHourStart.value = timeString;
									}
									else {
										elementHourEnd.value = timeString;
									}
								},
								function() {
									if(confirm("test")) {
										deleteRow(tableId, cellId.innerHTML);
									}
								}
							];
			
			for(var i = 0; i < buttonTexts.length; i++) {
				var btn = document.createElement("input");
				btn.type = "button";
				btn.value = buttonTexts[i];
				btn.style = "position: relative;";
				btn.onclick = buttonFuncs[i];
				btn.title = buttonTitles[i];
				
				funcs.appendChild(btn);
			}
			
			for(var i = 2; i < table.rows.length - 1; i++) {
				if(table.rows[i].cells[0].innerHTML == cellId.innerHTML) {	
					elementHourStart.value = table.rows[i - 1].cells[3].childNodes[1].value;
					break;
				}
			}
		}
	
		function download(filename, text) {
			var element = document.createElement("a");
			element.setAttribute("href", "data:text/plain; charset = utf-8" + encodeURIComponent(text));
			element.setAttribute("download", filename);

			element.style.display = "none";
			document.body.appendChild(element);

			element.click();

			document.body.removeChild(element);
		}
		
		function setPlan(plan) {
			if(plan == 1) {
				document.getElementById("hoursTablePlan1").style.display = "";
				document.getElementById("hoursTablePlan2").style.display = "none";
				
				document.getElementById("buttonPlan1").style.backgroundColor = "#404040"
				document.getElementById("buttonPlan2").style.backgroundColor = "#787878";
			}
			else {
				document.getElementById("hoursTablePlan1").style.display = "none";
				document.getElementById("hoursTablePlan2").style.display = "";
				
				document.getElementById("buttonPlan1").style.backgroundColor = "#787878";
				document.getElementById("buttonPlan2").style.backgroundColor = "#404040";
			}
		}
		
		
		setPlan(1);
		addRow('hoursTablePlan1');
		addRow('hoursTablePlan2');
	</script>
	<style>
		
	</style>
</html>